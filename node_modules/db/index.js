var mongodbclient = require('mongodb').MongoClient;
var mongodb;

mongodbclient.connect("mongodb://69.164.216.31:27017/hackru", function(err, db) {
  if(!err) {
    console.log("Mongo connection succeeded");
    mongodb = db;
  }
  else {
    console.log(err);
  }
});

exports.createAccount = function(username, password, name, age, heartbeatwarning, heartbeatdanger) {
  mongodb.createCollection('users');
  var users = mongodb.collection('users');
  users.insert({'username':username, 'password':password, 'name':name, 'age':age, 'heartbeatwarning':heartbeatwarning, 'heartbeatdanger':heartbeatdanger});;
}

exports.loginAccount = function(username, password, callback) {
  mongodb.createCollection('users');
  var users = mongodb.collection('users');
  users.findOne({'username':username, 'password':password}, function(err, cursor) {
    if(cursor == null)
      return callback('error');
    return callback(cursor);
  });
}

exports.updateHeartbeat = function(username, password, heartbeat) {
  mongodb.createCollection('users');
  var users = mongodb.collection('users');
  users.update({'username':username, 'password':password},{$set:{'heartbeat':heartbeat}});
}
