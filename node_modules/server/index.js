var express = require('express');
var app = express();
var bodyparser = require('body-parser');

var mongo = require('db');

app.use(bodyparser.json());
app.use(bodyparser.urlencoded({ extended: true }));

var server = app.listen(3000, function () {
  console.log('Example app listening on port 3000!');
});

app.post('/create', function (req, res) {
  mongo.createAccount(req.param('username'),req.param('password'),req.param('name'),req.param('age'),req.param('heartbeatwarning'),req.param('heartbeatdanger'), req.param('usernumber'), req.param('emcnumber'));
  console.log("Account created");
});

app.post('/login', function (req, res) {
  mongo.loginAccount(req.param('username'),req.param('password'), function(profile) {
    if(profile == 'error')
      res.send('error');
    res.send(profile);
  });
  console.log("Login successful");
});

app.post('/updateHeartbeat', function(req, res) {
  mongo.updateHeartbeat(req.param('username'), req.param('password'), req.param('heartbeat'));
  console.log("Avg heartbeat updated");
});

exports.closeServer = function() {
  server.close();
  console.log("Successfully closed server");
}
